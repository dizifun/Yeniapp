name: Film Listesini Güncelle (TMDB)

on:
  schedule:
    # Her 6 saatte bir çalışır (TMDB'yi çok yormamak için ideal)
    - cron: '0 */6 * * *'
  
  # İstediğin zaman elle "Run" butonuna basıp çalıştırabilmen için
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Adım: Repodaki dosyaları sanal makineye çek
      - name: Repoyu Kontrol Et (Checkout)
        uses: actions/checkout@v3

      # 2. Adım: Python Kurulumu
      - name: Python Kur
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. Adım: Kütüphaneleri Yükle (ENTEGRE EDİLDİ)
      # requirements.txt dosyasına ihtiyacın yok, buradan direkt kuruyoruz.
      - name: Gerekli Kütüphaneyi Kur
        run: |
          python -m pip install --upgrade pip
          pip install requests

      # 4. Adım: Python Scriptini Çalıştır
      - name: Film Scriptini Başlat
        run: python update_movies.py
        
      # 5. Adım: Oluşan JSON dosyasını GitHub'a kaydet
      - name: Değişiklikleri Kaydet (Push)
        run: |
          git config --global user.name 'FilmBotu'
          git config --global user.email 'bot@film.com'
          git add filmler_tmdb.json
          # Değişiklik varsa commit at, yoksa hata verme devam et
          git diff --quiet && git diff --staged --quiet || (git commit -m "Film listesi güncellendi: $(date)" && git push)
