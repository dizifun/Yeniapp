name: Film Listesini Güncelle (TMDB)

on:
  schedule:
    # Her 6 saatte bir çalışır (TMDB limitlerine takılmamak için ideal süre)
    - cron: '0 */6 * * *'
  
  # İstediğin zaman elle "Run workflow" diyebilmen için
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Adım: Repoyu sanal makineye çek
      - name: Repoyu Kontrol Et (Checkout)
        uses: actions/checkout@v3

      # 2. Adım: Python Kurulumu
      - name: Python Kur
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. Adım: Gerekli Kütüphaneyi Yükle (Dosya aramadan direkt kurar)
      - name: Gerekli Kütüphaneyi Kur
        run: |
          python -m pip install --upgrade pip
          pip install requests

      # 4. Adım: Python Scriptini Çalıştır
      - name: Film Scriptini Başlat
        run: python update_movies.py
        
      # 5. Adım: Hata Veren Kısmın Düzeltilmiş Hali (Önce Çek Sonra Yükle)
      - name: Değişiklikleri Kaydet (Push)
        run: |
          git config --global user.name 'FilmBotu'
          git config --global user.email 'bot@film.com'
          
          # Dosyayı sahneye al
          git add filmler_tmdb.json
          
          # Eğer değişiklik varsa commitle, yoksa hata verme devam et
          git diff --quiet && git diff --staged --quiet || git commit -m "Film listesi güncellendi: $(date)"
          
          # --- ÇÖZÜM BURADA ---
          # Önce GitHub'daki yenilikleri çek (Pull), sonra kendi dosyanı gönder (Push)
          git pull --rebase origin main
          git push origin main
